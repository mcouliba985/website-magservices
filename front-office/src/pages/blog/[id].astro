---
import MainLayout from "../../layouts/main/Layout.astro";

interface Article {
  id: number;
  title: string;
  content: string;
  image?: string;
}

export async function getStaticPaths(): Promise<{ params: { id: string } }[]> {
  const res = await fetch("https://back.fmed.ml/api/articles");
  const articles: Article[] = await res.json();
  return articles.map((a) => ({
    params: { id: a.id.toString() },
  }));
}

const { id } = Astro.params;
let article: Article | null = null;

try {
  const res = await fetch(`https://back.fmed.ml/api/articles/${id}`);
  if (res.ok) {
    article = (await res.json()) as Article;
  }
} catch (error) {
  console.error("Erreur fetch:", error);
}
---

<MainLayout>
  {
    article ? (
      <>
        <h1>{article.title}</h1>
        {article.image && <img src={article.image} alt={article.title} />}
        <div>{article.content}</div>
      </>
    ) : (
      <p>Article introuvable.</p>
    )
  }
</MainLayout>
